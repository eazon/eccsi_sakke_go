/* Desp:
 */

package crypto

// Tips: 参数解读
// 除字段UserUri外，其他几个字段都是协议参数 数值类型的16进制字符串，即字符串的每两个字符 对应 参数数值的一个字节
// 字段UserID，正确解读: 88 36 9A A3 7F 5B 41 A0 1F D3 7A 51 92 30 58 89 6B 6E 5A 3F 3D 08 2E 54 5C D4 2E D6 4D 7B EB CD
var CCTest = &CertCache {
	PubEncKey:"04286462369dc569e1870466b954272f615817ae1d2b3860516d2c6e9366a9b838bf2fe4883292b883878990471f9fc333362526c7e39d7860907d7f3f003df4e8da0a6b76245f7d120d2735e83967375d50d0a40211138f7302284fc91422c7e63a42cb4dac4b03d57f5439d9139fbd6f33298dacf942b09cb498bb130fe1a1a22d1994c2bb91189a20d5b00d7ec5eb68f1b26ea10b3001fce2ae8f48ef13f3b5b5340d65e233846abb9d2a91caaeb7ce49f582f32d49e55821cc04bed4c388b413939f0e88b13e3e482341147eb869fdb2811333f4c157663cf1ef54a2bc3edfd534e5f262d3267b8a55f88e82b63dcd209039112f8f30b6d28435760632bcdb",
	PubAuthKey:"0440b5f8f5b45078282c96f66c8000a8dbf19e0031d7ffd9cb6e2a10f120fb2d0292e559894cd2f2959bbf97874e9c0a8ca98148e62c0b3fd5d3009070ec8300d9",
	UserUri:"sip:gms@mcptt.com",
	UserID:"88369AA37F5B41A01FD37A51923058896B6E5A3F3D082E545CD42ED64D7BEBCD",
	UserDecryptKey:"0447c90bbcb35ca9a567cddf1bc0b6f3c7c972d9fca273295d3dec03d059e687506793a9709148b7984b362da46dab004ade7ded9c128a990227f4bc4736212e949112754a7f6ab3ada9dc772c5afd4eb6408d3d1de9d1d3e80c7f870d36c3f8e7639bafbe65b1e660bcabf026871f0a2ada875b6c7fa1c9115db316268adb305a70742232f102b3496356dce4a5046f7d4ca467d17884443c55da6ccaa016b808465d603a4916667d4f4074a551ce0f6d962b0d7851defcef473e73aba8cca2dc1d84b3825fca0fe147d69918472f57e72885f814f971e15cd54048ccbaf37da8b66672e34a219910e39a4a56bae4077111aec849add0c91d6ff507ce75d40531",
	UserSigningKeySSK:"00006b4ada61f58de77696c2681ca6752f82714a40990f968c33c4800c0e207feb61",
	UserPubTokenPVT:"043179c7128fa6d005533344efba5d55925cbe3d3600ba81bad98ec329f2ec7672f56bcef2388ddcaf942e084265275fa477bca11f5b0170e3fac86b7eed2fb8a5",
}

// 加解密参数来自 rfc6508 Appendix A. Test Data
var CCTest1 = &CertCache {
	PubEncKey:"045958EF1B1679BF099B3A030DF255AA6A23C1D8F143D4D23F753E69BD27A832F38CB4AD53DDEF4260B0FE8BB45C4C1FF510EFFE300367A37B61F701D914AEF09724825FA0707D61A6DFF4FBD7273566CDDE352A0B04B7C16A78309BE640697DE747613A5FC195E8B9F328852A579DB8F99B1D0034479EA9C5595F47C4B2F54FF21508D37514DCF7A8E143A6058C09A6BF2C9858CA37C258065AE6BF7532BC8B5B63383866E0753C5AC0E72709F8445F2E6178E065857E0EDA10F68206B63505ED87E534FB2831FF957FB7DC619DAE61301EEACC2FDA3680EA4999258A833CEA8FC67C6D19487FB449059F26CC8AAB655AB58B7CC796E24E9A394095754F5F8BAE",
	PubAuthKey:"0440b5f8f5b45078282c96f66c8000a8dbf19e0031d7ffd9cb6e2a10f120fb2d0292e559894cd2f2959bbf97874e9c0a8ca98148e62c0b3fd5d3009070ec8300d9",
	UserUri:"sip:gms@mcptt.com",
	UserID:"323031312D30320074656C3A2B34343737303039303031323300",
	UserDecryptKey:"0493AF67E5007BA6E6A80DA793DA300FA4B52D0A74E25E6E7B2B3D6EE9D18A9B5C5023597BD82D8062D34019563BA1D25C0DC56B7B979D74AA50F29FBF11CC2C93F5DFCA615E609279F6175CEADB00B58C6BEE1E7A2A47C4F0C456F05259A6FA94A634A40DAE1DF593D4FECF688D5FC678BE7EFC6DF3D6835325B83B2C6E69036B155F0A27241094B04BFB0BDFAC6C670A65C325D39A069F03659D44CA27D3BE8DF311172B554160181CBE94A2A783320CED590BC42644702CF371271E496BF20F588B78A1BC01ECBB6559934BDD2FB65D2884318A33D1A42ADF5E33CC5800280B28356497F87135BAB9612A17260424409AC15FEE996B744C332151235DECB0F5",
	UserSigningKeySSK:"00006b4ada61f58de77696c2681ca6752f82714a40990f968c33c4800c0e207feb61",
	UserPubTokenPVT:"043179c7128fa6d005533344efba5d55925cbe3d3600ba81bad98ec329f2ec7672f56bcef2388ddcaf942e084265275fa477bca11f5b0170e3fac86b7eed2fb8a5",
}

//签名参数来自 rfc6507 Appendix A. Test Data
var CCTest2 = &CertCache {
	PubEncKey:"045958EF1B1679BF099B3A030DF255AA6A23C1D8F143D4D23F753E69BD27A832F38CB4AD53DDEF4260B0FE8BB45C4C1FF510EFFE300367A37B61F701D914AEF09724825FA0707D61A6DFF4FBD7273566CDDE352A0B04B7C16A78309BE640697DE747613A5FC195E8B9F328852A579DB8F99B1D0034479EA9C5595F47C4B2F54FF21508D37514DCF7A8E143A6058C09A6BF2C9858CA37C258065AE6BF7532BC8B5B63383866E0753C5AC0E72709F8445F2E6178E065857E0EDA10F68206B63505ED87E534FB2831FF957FB7DC619DAE61301EEACC2FDA3680EA4999258A833CEA8FC67C6D19487FB449059F26CC8AAB655AB58B7CC796E24E9A394095754F5F8BAE",
	PubAuthKey:"0450D4670BDE75244F28D2838A0D25558A7A72686D4522D4C8273FB6442AEBFA93DBDD37551AFD263B5DFD617F3960C65A8C298850FF99F20366DCE7D4367217F4",
	UserUri:"sip:gms@mcptt.com",
	UserID:"323031312D30320074656C3A2B34343737303039303031323300",
	UserDecryptKey:"0493AF67E5007BA6E6A80DA793DA300FA4B52D0A74E25E6E7B2B3D6EE9D18A9B5C5023597BD82D8062D34019563BA1D25C0DC56B7B979D74AA50F29FBF11CC2C93F5DFCA615E609279F6175CEADB00B58C6BEE1E7A2A47C4F0C456F05259A6FA94A634A40DAE1DF593D4FECF688D5FC678BE7EFC6DF3D6835325B83B2C6E69036B155F0A27241094B04BFB0BDFAC6C670A65C325D39A069F03659D44CA27D3BE8DF311172B554160181CBE94A2A783320CED590BC42644702CF371271E496BF20F588B78A1BC01ECBB6559934BDD2FB65D2884318A33D1A42ADF5E33CC5800280B28356497F87135BAB9612A17260424409AC15FEE996B744C332151235DECB0F5",
	UserSigningKeySSK:"23F374AE1F4033F3E9DBDDAAEF20F4CF0B86BBD5A138A5AE9E7E006B34489A0D",
	UserPubTokenPVT:"04758A142779BE89E829E71984CB40EF758CC4AD775FC5B9A3E1C8ED52F6FA36D9A79D247692F4EDA3A6BDAB77D6AA6474A464AE4934663C5265BA7018BA091F79",
}

// 数据来源：mcs
var CCTest3 = &CertCache {
	PubEncKey:"04286462369dc569e1870466b954272f615817ae1d2b3860516d2c6e9366a9b838bf2fe4883292b883878990471f9fc333362526c7e39d7860907d7f3f003df4e8da0a6b76245f7d120d2735e83967375d50d0a40211138f7302284fc91422c7e63a42cb4dac4b03d57f5439d9139fbd6f33298dacf942b09cb498bb130fe1a1a22d1994c2bb91189a20d5b00d7ec5eb68f1b26ea10b3001fce2ae8f48ef13f3b5b5340d65e233846abb9d2a91caaeb7ce49f582f32d49e55821cc04bed4c388b413939f0e88b13e3e482341147eb869fdb2811333f4c157663cf1ef54a2bc3edfd534e5f262d3267b8a55f88e82b63dcd209039112f8f30b6d28435760632bcdb",
	PubAuthKey:"0440b5f8f5b45078282c96f66c8000a8dbf19e0031d7ffd9cb6e2a10f120fb2d0292e559894cd2f2959bbf97874e9c0a8ca98148e62c0b3fd5d3009070ec8300d9",
	UserUri:"sip:60030208@mcptt.common.com",
	UserID:"971F2CA069D3A6283073B5ECA9DE92CEDCC4A27D376D7AD39BDCE4063E90E434",
	UserDecryptKey:"045f9cac63f7325773a909a179502e06de217370d2160e3a249ac47a41422d9d82a6a04562724fc825523ab6e821f3e7ced608473af3cc201019be6e1b9d4602c1ad37d8e3e604c9a6b19249572ffeafea61b550954d8e8e65b28a48b08b7c931f11e94f526a17669c1020f243b3394984522dbc160985f4fa9b9ef354136140496b033ceef18b57419a4dec41612e2be36dc9c0e8e3240ca2c160f8b0f2efd2ad311e25b488e01835f5edc36a090fcdc4c5ebb33726e6996d3911bc71272a6ed49d503460455f3ec6eef4d21ed6ffa000c05ab25a87ca139368707e88ce9f6c6232052b84741e6b72336d6a75adfdb5f489e07802b9043251fc3d2006ff23b758",
	UserSigningKeySSK:"0000dea16fdf2389113a380e75a883af298052de643d448fc2af53af2616603ff3cc",
	UserPubTokenPVT:"047fffa3181fcfd7f2b26c25801596cd7d6f2b9d1cac652b4f1fc7ad370fa9fac01be08451de1fc88a720544eb218da2a136a07f0fd971fd42b24693fc915ae7c7",
}

// 数据来源：mcs
var CCTest4 = &CertCache {
	PubEncKey:"04286462369dc569e1870466b954272f615817ae1d2b3860516d2c6e9366a9b838bf2fe4883292b883878990471f9fc333362526c7e39d7860907d7f3f003df4e8da0a6b76245f7d120d2735e83967375d50d0a40211138f7302284fc91422c7e63a42cb4dac4b03d57f5439d9139fbd6f33298dacf942b09cb498bb130fe1a1a22d1994c2bb91189a20d5b00d7ec5eb68f1b26ea10b3001fce2ae8f48ef13f3b5b5340d65e233846abb9d2a91caaeb7ce49f582f32d49e55821cc04bed4c388b413939f0e88b13e3e482341147eb869fdb2811333f4c157663cf1ef54a2bc3edfd534e5f262d3267b8a55f88e82b63dcd209039112f8f30b6d28435760632bcdb",
	PubAuthKey:"0440b5f8f5b45078282c96f66c8000a8dbf19e0031d7ffd9cb6e2a10f120fb2d0292e559894cd2f2959bbf97874e9c0a8ca98148e62c0b3fd5d3009070ec8300d9",
	UserUri:"sip:60030208@mcvideo.common.com",
	UserID:"F9A0A43CB9D2586BF7BEE63B31966270E027952928C2C5BE4E4D92BAEF0492D7",
	UserDecryptKey:"042cc883f7dcedf8613bfb544cfa559c1ed3a060ddc3015e232d21ed26c35433309234071ebaa65c19883dd6231fbc4937ddae58e56ef148a90da325ce2ceeea222133109179642ee9b595af759d9fc056fcdcb788995717ef606b26a9796368903ae8b092b50cf836627ba15189e52be892a3f4c9ff8c37e586dd1cdf47d6abb358add9dc3b1750c65c33f5713c5c311c0df47f395381b94ebb9e754a34a7254829d4b5ef3ebd534a1c946ddfc81f8b954e35397651d6ae15ee3548ded2a27c93368300fa5d39239be904a1345745007d577ae3558ed6d5a17d769c1bea304ec017a6f337866b9fc4e013919ada8c5b9432eef5d1d5e4105c8e2183073e06a4a5",
	UserSigningKeySSK:"0000c15fd0c2605466db2e7839272e5b87799423a35c2fb65cdc7e5e68d67fe72510",
	UserPubTokenPVT:"047f1ca855f883a7ca5eefc4b45dc863046ad42f7f503a124d29edbf4d4f5f578217d99a1dd4799caf252493b1ef799d7855a7faa2c2c78874a66d3363649d4ee5",
}

// 数据来源：mcs
var CCTest5 = &CertCache {
	PubEncKey:"04286462369dc569e1870466b954272f615817ae1d2b3860516d2c6e9366a9b838bf2fe4883292b883878990471f9fc333362526c7e39d7860907d7f3f003df4e8da0a6b76245f7d120d2735e83967375d50d0a40211138f7302284fc91422c7e63a42cb4dac4b03d57f5439d9139fbd6f33298dacf942b09cb498bb130fe1a1a22d1994c2bb91189a20d5b00d7ec5eb68f1b26ea10b3001fce2ae8f48ef13f3b5b5340d65e233846abb9d2a91caaeb7ce49f582f32d49e55821cc04bed4c388b413939f0e88b13e3e482341147eb869fdb2811333f4c157663cf1ef54a2bc3edfd534e5f262d3267b8a55f88e82b63dcd209039112f8f30b6d28435760632bcdb",
	PubAuthKey:"0440b5f8f5b45078282c96f66c8000a8dbf19e0031d7ffd9cb6e2a10f120fb2d0292e559894cd2f2959bbf97874e9c0a8ca98148e62c0b3fd5d3009070ec8300d9",
	UserUri:"sip:4245037@mcptt.common.com",
	UserID:"C21CE15C2061C384E576DB9B6AA8CF22CFC53060AC8F5993D8E092307FD8BE4D",
	UserDecryptKey:"04853645b73ff9a5252c8454114c428b11e61240a508396fbdcf3a7702ac0819222c8d929ccb7d699be8da61a3a16431d4857c491d6c27fc8fad71866de5ccdfa9bbd0c8ae0168f6b86fd437eded87424f8eb84ecb9f84bcabb3d2f919eb131306bed65b78907eb1b755333be27f3a222e61b509df7705b0f93d1e458809ccbc2e8628cf3e29eeb25d8115a45ac8e9236fbbf75a70653d1de03b0d070866b66f01d90f7c1185e5a12dc9044afa74607e07a366debb5779e27e943b395a39dad032d985a51cbdae5574756d8d997150784a4bc93012ba6cbf67b3c4f787a11247013ba4c3b350ea734a7b49409c2387c5e83776f3896dd7165861ff7d362b65145f",
	UserSigningKeySSK:"000043a18acdbac58818d29b0f2bf3839a1df131fb4140a15688daad11fbf817c600",
	UserPubTokenPVT:"04257d5bab9a509297cd0e0489d872e53a3db32f0885b6d31ad1ae3214b8f21553f91f07f74ae11221a7bc2d0a772957212442a3300173c1338d2b4bdff6a35e06",
}

var CC *CertCache

/*
// 从Init应答中提取出的关键字段
type Certificate struct {
	PubEncKey 	string      //RFC6508中描述的SAKKE的公共密钥, "Z_T",. 用来描述椭圆曲线上的一个点的8位字节串（eg：029A2F）
	PubAuthKey 	string     	//RFC6507中描述的ECCSI 公共密钥 "KPAK". 用来描述椭圆曲线上的一个点的8位字节串（eg：029A2F）
}

// 初始化从KMS获取到的证书和密钥材料
func InitCertCache(cert *Certificate, km *KeyMaterial) {
	slog.Info("init CertCache.")

	cc := CertCache{}
	// 由KMS证书 m_cert 获取数据
	cc.PubEncKey = cert.PubEncKey              //[RFC6508] SAKKE KMS公钥 Z_T
	cc.PubAuthKey = cert.PubAuthKey            //[RFC6507] ECCSI 公钥 KPAK

	// 由KMS密钥材料 m_key 获取数据
	cc.UserUri = km.UserUri
	cc.UserID = km.UserID
	cc.UserDecryptKey = km.UserDecryptKey     	//[RFC6508] SAKKE RSK
	cc.UserSigningKeySSK = km.UserSigningKeySSK  //[RFC6507] ECCSI SSK
	cc.UserPubTokenPVT = km.UserPubTokenPVT	   	//[RFC6507] ECCSI PVT

	slog.Info("PubEncKey[%d] %s", len(cc.PubEncKey), cc.PubEncKey)
	slog.Info("PubAuthKey[%d] %s", len(cc.PubAuthKey), cc.PubAuthKey)

	slog.Info("UserUri[%d] %s", len(cc.UserUri), cc.UserUri)
	slog.Info("UserID[%d] %s", len(cc.UserID), cc.UserID)
	slog.Info("UserDecryptKey[%d] %s", len(cc.UserDecryptKey), cc.UserDecryptKey)
	slog.Info("UserSigningKeySSK[%d] %s", len(cc.UserSigningKeySSK), cc.UserSigningKeySSK)
	slog.Info("UserPubTokenPVT[%d] %s", len(cc.UserPubTokenPVT), cc.UserPubTokenPVT)

	CC = &cc
}
*/

type CertCache struct {
	PubEncKey 		string		//RFC6508中描述的SAKKE公共密钥"Z_T" 用来描述椭圆曲线上的一个点的8位字节串
	PubAuthKey 		string		//RFC6507中描述的ECCSI公共密钥"KPAK" 用来描述椭圆曲线上的一个点的8位字节串

	UserUri 			string	//这批密钥的使用者的URI
	UserID 				string	//密钥对应的UID
	UserDecryptKey 		string	//RFC6508中描述的SAKKE RSK 用来描述椭圆曲线上的一个点的8位字节串
	UserSigningKeySSK 	string	//RFC6507中描述的ECCSI 私钥"SSK" 描述一个整数的8位字节串，用于eccsi 签名发送数据
	UserPubTokenPVT 	string	//RFC6507中描述的ECCSI 令牌"PVT" 用来描述椭圆曲线上的一个点的8位字节串, 用于eccsi 签名发送数据
}